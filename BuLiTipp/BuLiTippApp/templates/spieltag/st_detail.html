<!-- Optional: no_navigation="true"  -->
{% load url from future %}
{% load filters %}
<!--st_detail-->
<script>
spiele_tippbar=0
</script>
<script language="JavaScript">
// Ziel-Datum in MEZ
var jahr={{spieltag.datum.year}}, monat={{spieltag.datum.month}}, tag={{spieltag.datum.day}}, stunde={{spieltag.datum.hour}}, minute={{spieltag.datum.minute}}, sekunde={{spieltag.datum.second}};
var zielDatum=new Date(jahr,monat-1,tag,stunde,minute,sekunde);

function countdown(id_) {
startDatum=new Date(); // Aktuelles Datum

// Countdown berechnen und anzeigen, bis Ziel-Datum erreicht ist
if(startDatum<zielDatum)  {

var jahre=0, monate=0, tage=0, stunden=0, minuten=0, sekunden=0;

// Jahre
while(startDatum<zielDatum) {
	jahre++;
	startDatum.setFullYear(startDatum.getFullYear()+1);
}
startDatum.setFullYear(startDatum.getFullYear()-1);
jahre--;

// Monate
while(startDatum<zielDatum) {
	monate++;
	startDatum.setMonth(startDatum.getMonth()+1);
}
startDatum.setMonth(startDatum.getMonth()-1);
monate--;

// Tage
while(startDatum.getTime()+(24*60*60*1000)<zielDatum) {
	tage++;
	startDatum.setTime(startDatum.getTime()+(24*60*60*1000));
}

// Stunden
stunden=Math.floor((zielDatum-startDatum)/(60*60*1000));
startDatum.setTime(startDatum.getTime()+stunden*60*60*1000);

// Minuten
minuten=Math.floor((zielDatum-startDatum)/(60*1000));
startDatum.setTime(startDatum.getTime()+minuten*60*1000);

// Sekunden
sekunden=Math.floor((zielDatum-startDatum)/1000);

// Anzeige formatieren
if(jahre>0){
	(jahre!=1)?jahre=jahre+" Jahre,  ":jahre=jahre+" Jahr,  ";
}else{
	jahre=""
}          
if(monate>0){
	(monate!=1)?monate=monate+" Monate,  ":monate=monate+" Monat,  ";
}else{
	monate=""
}
(tage!=1)?tage=tage+" Tage,  ":tage=tage+" Tag,  ";
(stunden!=1)?stunden=stunden+" Stunden,  ":stunden=stunden+" Stunde,  ";
(minuten!=1)?minuten=minuten+" Minuten  und  ":minuten=minuten+" Minute  und  ";
if(sekunden<10) sekunden="0"+sekunden;
(sekunden!=1)?sekunden=sekunden+" Sekunden":sekunden=sekunden+" Sekunde";

document.getElementById(id_).innerHTML=
	"noch "+
	jahre+monate+tage+stunden+minuten+sekunden+
	" verbleibend!";
	
setTimeout(function() { countdown(id_);},1000);
}
// Anderenfalls alles auf Null setzen
else document.getElementById(id_).innerHTML=
	"Datum: {{spieltag.datum}}";
}
  
</script>
<script>
function mark_verein(verein_id){
	var trs = document.getElementsByName("tabelle_verein_" + verein_id);
	for (var i = 0; i < trs.length; ++i){
		trs[i].className="active";
	}
}
function clear_marked_verein(){
	var tabelle = document.getElementsByName("tabelle_verein");
	for (var i = 0; i < tabelle.length; ++i){
		var trs = tabelle[i].getElementsByTagName("tr");
		for (var j = 0; j < trs.length; ++j){
			trs[j].className = ""
		}
	}
}
</script>

<p size="75" id="countdowninput{{spieltag.id}}" onfocus="if(this.blur)this.blur()"></p>

<script>
	var id1=Math.random()*100000000000000000;
	document.getElementById('countdowninput{{spieltag.id}}').id=document.getElementById('countdowninput{{spieltag.id}}').id+id1
	countdown('countdowninput{{spieltag.id}}'+id1)
</script>

{% if spieltag.spiele %}
	<form method="post" action="{% url "tipp" spielzeit.id spieltag.id %}">
	{% csrf_token  %}
	<div class="table-responsive">
		<table class="table">
			<thead>
				<tr >
					{% block spiel_header%}
						<th colspan=3 class="text-center">Spiel</th >
					{% endblock %}
					<th class="text-center">Ergebnis</th > 
					{% if user.is_authenticated %}
						<th class="text-center"><nobr>mein Tipp</nobr></th>
					{% endif %}
					{% block additional_header %}
					{% endblock %}
				</tr>
			</thead>
			<tbody>
				{% for spiel in spieltag.spiele  %}
				{% with h=spiel.heimmannschaft.id a=spiel.auswaertsmannschaft.id szid=spieltag.spielzeit.id%}
				<tr onmouseover="clear_marked_verein(); mark_verein({{spiel.heimTeam.id}}); mark_verein({{spiel.auswTeam.id}});">
				{% block spiel_column %}
					<td class="text-right">
						<b>{{ spiel.heimTeam }}</b>  
					</td>
					<td class="text-center">
						vs 
					</td>
					<td class="text-left">
						<b>{{ spiel.auswTeam }}</b> 
					</td>
				{% endblock %}
				<td>
					<center>
						{% if spiel.tippbar %}
							tippen!
						{% else %}
							{% comment %}striptags is used to convert ergebnis to string, bc somehow it seems not to be a real string sometimes{% endcomment %}
							{% if spiel.ergebnis and "DNF" not in spiel.ergebnis|striptags %}
								{{ spiel.ergebnis }}
							{% else %}
								{% if user.is_staff %}
								<a href ="{% url "admin:BuLiTippApp_spieltag_change" spieltag.id %}">
								{% endif %}
								eintragen!
								{% if user.is_staff %}
								</a>
								{% endif %}
							{% endif %}
					{% endif %}
					</center>
				</td>
				{% if user.is_authenticated %}
				<td>
					{% if spiel.tippbar  %}
						<script>
						spiele_tippbar+=1
						</script>
						<input type="text" 
							name="tipp_{{ spiel.id  }}" 
							style="width:50px" 
							id="tipp{{ spiel.id  }}"
							{% if spiel.eigenerTipp and spiel.eigenerTipp.ergebnis and "DNF" not in spiel.eigenerTipp.ergebnis|striptags %}
							value="{{ spiel.eigenerTipp.ergebnis }}"
							{% else %}
							value=""
							{% endif %}
							pattern="[0-9]{1,2}:[0-9]{1,2}"
							placeholder="tippen"
							title="Bitte Ergebnis im Format x:y angeben!">
					{% elif spiel.eigenerTipp and spiel.eigenerTipp.ergebnis %}
						<center class="tipp{{spiel.eigenerTipp.punkte}}">
							{{ spiel.eigenerTipp.ergebnis }}
							{% if spiel.eigenerTipp.punkte >= 0 %}
								({{ spiel.eigenerTipp.punkte }})
							{% endif %}
						</center>
					{% endif %}
				</td>
				{% endif %}
				{% block additional_column %}
				{% endblock %}
			</tr>
			{% endwith %}
			{% endfor %}
		</table>
	</div>
	<input type="hidden" name="referer" value="{{referer}}" />
	{% if user.is_authenticated %}
	<input class="btn btn-success pull-right right" type="submit" value="Tipp abgeben!" id="tippabgeben_button" /><br>
	<script>
	if (spiele_tippbar == 0)
		document.getElementById('tippabgeben_button').remove()
	</script>
		{% if user.is_staff %}
		{% endif %}
	{% endif %}
	</form>
	{% include "spieltag/st_nav.html" %}
{% else %}
	<p>Keine Spiele an diesem Spieltag.</p>
{% endif %}

